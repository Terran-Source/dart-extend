# Automatically generated on 2021-09-13 UTC from https://codemagic.io/app/613f7c3ff53ad33abb9aa041/settings
# Note that this configuration is not an exact match to UI settings. Review and adjust as necessary.

workflows:
  # dart-latest-workflow:
  #   name: Dart Latest Workflow
  #   instance_type: mac_mini
  #   max_build_duration: 30
  #   environment:
  #     flutter: stable
  #   cache:
  #     cache_paths:
  #       - $FLUTTER_ROOT/.pub-cache
  #       - ~/.pub-cache
  #   triggering:
  #     events:
  #       - push
  #       - pull_request
  #       - tag
  #     branch_patterns:
  #       - pattern: main
  #         include: true
  #         source: true
  #       - pattern: dev
  #         include: true
  #         source: true
  #       - pattern: feature/*
  #         include: true
  #         source: true
  #       - pattern: hotfix/*
  #         include: true
  #         source: true
  #     tag_patterns:
  #       - pattern: v[1-9]*.[0-9]*
  #         include: true
  #       - pattern: v[1-9]*.[0-9]*.[0-9]*
  #         include: true
  #   scripts:
  #     - name: Check SDK versions
  #       script: |
  #         # export PATH=$FLUTTER_ROOT/bin:$FLUTTER_ROOT/.pub-cache/bin:$PATH
  #         echo "----"
  #         flutter --version
  #         echo "----"
  #         $FLUTTER_ROOT/bin/dart --version
  #         echo "----"
  #     # - name: Check Project Directory
  #     #   script: |
  #     #     echo "Project path: $FCI_BUILD_DIR"
  #     - name: Test Project & Run Example
  #       script: |
  #         cd $FCI_BUILD_DIR
  #         $FLUTTER_ROOT/bin/dart pub get
  #         mkdir -p test-results
  #         $FLUTTER_ROOT/bin/dart test --file-reporter json:test-results/test-results.json
  #         mkdir -p example-results
  #         $FLUTTER_ROOT/bin/dart run example/extend_example.dart > example-results/example-results.txt
  #       test_report: test-results/test-results.json
  #     - name: Dart Code Metrics
  #       script: |
  #         if [[ -z ${SKIP_CODE_METRICS+x} && "$SKIP_CODE_METRICS" == "1" ]]; then
  #           echo "Skipping Dart Code Metrics check"
  #         else
  #           flutter pub global activate dart_code_metrics 4.2.1
  #           cd $FCI_BUILD_DIR
  #           mkdir -p metrics-results
  #           flutter pub global run dart_code_metrics:metrics analyze lib --reporter=json > metrics-results/dart_code_metrics.json
  #         fi
  #       test_report: metrics-results/dart_code_metrics.json
  #   artifacts:
  #     - test-results/test-results.json
  #     - example-results/example-results.txt
  #     - metrics-results/dart_code_metrics.json
  #   publishing:
  #     email:
  #       recipients:
  #         - patra.tamal@gmail.com
  dart-null-safety-workflow:
    name: Dart Null Safety Workflow
    instance_type: mac_mini
    max_build_duration: 30
    environment:
      vars:
        SKIP_CODE_METRICS: 1
      flutter: 2.0.0-stable
    cache:
      cache_paths:
        - $FLUTTER_ROOT/.pub-cache
        - ~/.pub-cache
    triggering:
      events:
        - push
        - pull_request
        - tag
      branch_patterns:
        - pattern: main
          include: true
          source: true
        - pattern: dev
          include: true
          source: true
        - pattern: feature/*
          include: true
          source: true
        - pattern: hotfix/*
          include: true
          source: true
      tag_patterns:
        - pattern: v[1-9]*.[0-9]*
          include: true
        - pattern: v[1-9]*.[0-9]*.[0-9]*
          include: true
    scripts:
      - name: Check SDK versions
        script: |
          # export PATH=$FLUTTER_ROOT/bin:$FLUTTER_ROOT/.pub-cache/bin:$PATH
          echo "----"
          flutter --version
          echo "----"
          $FLUTTER_ROOT/bin/dart --version
          echo "----"
      # - name: Check Project Directory
      #   script: |
      #     echo "Project path: $FCI_BUILD_DIR"
      - name: Test Project & Run Example
        script: |
          cd $FCI_BUILD_DIR
          $FLUTTER_ROOT/bin/dart pub get
          mkdir -p test-results
          $FLUTTER_ROOT/bin/dart test --file-reporter json:test-results/test-results.json
          mkdir -p example-results
          $FLUTTER_ROOT/bin/dart run example/extend_example.dart > example-results/example-results.txt
        test_report: test-results/test-results.json
      - name: Dart Code Metrics
        script: |
          echo "SKIP_CODE_METRICS: $SKIP_CODE_METRICS"
          if [[ -z ${SKIP_CODE_METRICS+x} && "$SKIP_CODE_METRICS" == "1" ]]; then
            echo "Skipping Dart Code Metrics check"
          else
            # flutter pub global activate dart_code_metrics 4.2.1
            # cd $FCI_BUILD_DIR
            # mkdir -p metrics-results
            # flutter pub global run dart_code_metrics:metrics analyze lib --reporter=json > metrics-results/dart_code_metrics.json
            echo "Will run Dart Code Metrics check"
          fi
        test_report: metrics-results/dart_code_metrics.json
    artifacts:
      - test-results/test-results.json
      - example-results/example-results.txt
      - metrics-results/dart_code_metrics.json
    publishing:
      email:
        recipients:
          - patra.tamal@gmail.com
