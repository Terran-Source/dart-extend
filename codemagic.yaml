# Automatically generated on 2021-09-13 UTC from https://codemagic.io/app/613f7c3ff53ad33abb9aa041/settings
# Note that this configuration is not an exact match to UI settings. Review and adjust as necessary.

workflows:
  # ios-workflow:
  #   name: Mac Workflow
  #   max_build_duration: 30
  #   environment:
  #     flutter: stable
  #     xcode: latest
  #     cocoapods: default
  #   cache:
  #     cache_paths:
  #       - ~/.pub-cache
  #   triggering:
  #     events:
  #       - push
  #       - pull_request
  #       - tag
  #     branch_patterns:
  #       - pattern: main
  #         include: true
  #         source: true
  #       - pattern: dev
  #         include: true
  #         source: true
  #       - pattern: feature/*
  #         include: true
  #         source: true
  #     tag_patterns:
  #       - pattern: v[1-9]*.[0-9]*
  #         include: true
  #       - pattern: v[1-9]*.[0-9]*.[0-9]*
  #         include: true
  #   scripts:
  #     - flutter packages pub get
  #     - 'flutter '
  #     - flutter pub global run dart_code_metrics:metrics analyze lib
  #     - dart test
  #     - dart run ./example/extend_example.dart
  #   artifacts:
  #     - flutter_drive.log
  #   publishing:
  #     email:
  #       recipients:
  #         - patra.tamal@gmail.com
  dart-workflow:
    name: Dart Workflow
    max_build_duration: 30
    environment:
      flutter: stable
    cache:
      cache_paths:
        - $FLUTTER_ROOT/.pub-cache
        - ~/.pub-cache
    triggering:
      events:
        - push
        - pull_request
        - tag
      branch_patterns:
        - pattern: main
          include: true
          source: true
        - pattern: dev
          include: true
          source: true
        - pattern: feature/*
          include: true
          source: true
        - pattern: hotfix/*
          include: true
          source: true
      tag_patterns:
        - pattern: v[1-9]*.[0-9]*
          include: true
        - pattern: v[1-9]*.[0-9]*.[0-9]*
          include: true
    scripts:
      - name: Check Dependency versions
        script: |
          # export PATH=$FLUTTER_ROOT/bin:$FLUTTER_ROOT/.pub-cache/bin:$PATH
          echo "----"
          flutter --version
          echo "----"
          $FLUTTER_ROOT/bin/dart --version
          echo "----"
      - name: Goto Project Directory
        script: |
          echo "Project path: $FCI_BUILD_DIR"
          cd $FCI_BUILD_DIR
      - name: Get Dart packages
        script: flutter packages pub get
      - name: Test Project
        script: |
          flutter test
      - name: Run Example
        script: |
          mkdir -p example-results
          $FLUTTER_ROOT/bin/dart run example/extend_example.dart > example-results/example-results.txt
        test_report: example-results/example-results.txt
      - name: Dart Code Metrics
        script: |
          flutter pub global activate dart_code_metrics 4.2.1
          mkdir -p metrics-results
          flutter pub global run dart_code_metrics:metrics analyze lib --reporter=json > metrics-results/dart_code_metrics.json
        test_report: metrics-results/dart_code_metrics.json
    artifacts:
      - flutter_drive.log
    publishing:
      email:
        recipients:
          - patra.tamal@gmail.com
